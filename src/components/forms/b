import React, { useState } from 'react';
import { CModal, CModalHeader, CModalBody, CModalFooter, CButton, CForm, CFormInput, CFormFeedback, CSpinner } from '@coreui/react';

const UploadFileModal = ({ visible, onClose, onFileUpload }) => {
  const [file, setFile] = useState(null);
  const [fileError, setFileError] = useState('');
  const [loading, setLoading] = useState(false);

  const handleFileChange = (e) => {
    setFile(e.target.files[0]);
    setFileError('');
  };

  const handleSubmit = (e) => {
    e.preventDefault();

    if (!file) {
      setFileError('Please select a file');
      return;
    }

    setLoading(true);

    const formData = new FormData();
    formData.append('file', file);

    // API call to upload file
    axios.post(`${base_url}/api/files/upload`, formData)
      .then(response => {
        setLoading(false);
        onFileUpload(response.data);  // Pass uploaded file data back to the parent component
        onClose();  // Close the modal
      })
      .catch(error => {
        setLoading(false);
        console.error('Error uploading file:', error);
      });
  };

  return (
    <CModal visible={visible} onClose={onClose}>
      <CModalHeader>Upload File</CModalHeader>
      <CForm onSubmit={handleSubmit}>
        <CModalBody>
          <CFormInput type="file" onChange={handleFileChange} />
          {fileError && <CFormFeedback>{fileError}</CFormFeedback>}
        </CModalBody>
        <CModalFooter>
          <CButton color="secondary" onClick={onClose} disabled={loading}>Close</CButton>
          <CButton color="primary" type="submit" disabled={loading}>
            {loading ? <CSpinner size="sm" /> : 'Upload'}
          </CButton>
        </CModalFooter>
      </CForm>
    </CModal>
  );
};

export default UploadFileModal;
